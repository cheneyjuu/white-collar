(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/mine/home"],{"2c99":function(t,n,e){"use strict";e.r(n);var o=e("3d17"),a=e("f070");for(var i in a)"default"!==i&&function(t){e.d(n,t,(function(){return a[t]}))}(i);e("ef42");var c,r=e("f0c5"),s=Object(r["a"])(a["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],c);n["default"]=s.exports},"3d17":function(t,n,e){"use strict";var o;e.d(n,"b",(function(){return a})),e.d(n,"c",(function(){return i})),e.d(n,"a",(function(){return o}));var a=function(){var t=this,n=t.$createElement;t._self._c},i=[]},4121:function(t,n,e){},"606a":function(t,n,e){"use strict";(function(t){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=i(e("277c"));function a(){if("function"!==typeof WeakMap)return null;var t=new WeakMap;return a=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var n=a();if(n&&n.has(t))return n.get(t);var e={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var c=o?Object.getOwnPropertyDescriptor(t,i):null;c&&(c.get||c.set)?Object.defineProperty(e,i,c):e[i]=t[i]}return e.default=t,n&&n.set(t,e),e}var c={name:"mine",data:function(){return{StatusBar:this.StatusBar,CustomBar:this.CustomBar,token:t.getStorageSync("id_token"),loginInfo:{},userInfo:t.getStorageSync("userInfo"),activityId:""}},methods:{wxGetUserInfo:function(){var n=this;t.getUserInfo({provider:"weixin",success:function(e){console.log({userinfo:e}),n.loginInfo=e,n.nickName=e.userInfo.nickName,n.avatarUrl=e.userInfo.avatarUrl;try{t.setStorageSync("isCanUse",!1),n.login()}catch(o){}},fail:function(t){}})},login:function(){t.removeStorageSync("sessionId");var n=this,e=t.getStorageSync("isCanUse");!1===e&&(t.showLoading({title:"登录中..."}),t.login({provider:"weixin",success:function(e){n.isCanUse||t.getUserInfo({provider:"weixin",success:function(t){console.log({getUserInfo:t}),n.loginInfo=t}}),n.exchangeInfo(e.code)},fail:function(){},complete:function(){}}))},exchangeInfo:function(n){var e=this,a=this;t.request({url:"".concat(o.baseUrl,"/global/login/app"),method:"GET",header:{"content-type":"application/json"},data:{code:n,encryptedData:this.loginInfo.encryptedData,iv:this.loginInfo.iv},success:function(t){var n=t.data;500!==t.statusCode?(console.dir(n),a.updateAccount(n)):e.wxGetUserInfo()},fail:function(){},complete:function(){}})},updateAccount:function(n){console.log("update account"),console.log(n);var e=this;t.request({url:"".concat(o.baseUrl,"/global/account"),method:"POST",data:n,success:function(t){console.log(t),e.userInfo=n,e.authentication(n.openId)},fail:function(){},complete:function(){}})},authentication:function(n){var e=this,a=this;t.request({url:"".concat(o.baseUrl,"/authenticate"),data:{username:n,password:n},method:"POST",header:{"content-type":"application/json"},success:function(n){a.token=n.data.id_token,a.userInfo.avatarStyle="background-image:url(".concat(a.userInfo.avatarUrl,")"),console.log(a.userInfo.avatarStyle),t.setStorage({key:"userInfo",data:a.userInfo}),t.setStorage({key:"id_token",data:a.token,success:function(){t.hideLoading()}}),e.activityId&&t.navigateTo({url:"/pages/activity/details?activityId="+e.activityId})}})},onFavor:function(){var n=this.token;n?t.navigateTo({url:"/pages/mine/my-favor"}):t.showToast({icon:"none",title:"您还未登录"})},onBrowserHistory:function(){var n=this.token;n?t.navigateTo({url:"/pages/topic/history"}):t.showToast({icon:"none",title:"您还未登录"})},onActivity:function(){var n=this.token;n?t.navigateTo({url:"/pages/activity/myJoinActivies"}):t.showToast({icon:"none",title:"您还未登录"})},onMessage:function(){t.showToast({icon:"none",title:" 暂未开放"})},onCoupon:function(){var n=this.token;n?t.navigateTo({url:"/pages/coupon/myCoupons"}):t.showToast({icon:"none",title:"您还未登录"})}},onLoad:function(t){t&&(this.activityId=t.activityId)}};n.default=c}).call(this,e("543d")["default"])},c38a:function(t,n,e){"use strict";(function(t){e("18a1");o(e("66fd"));var n=o(e("2c99"));function o(t){return t&&t.__esModule?t:{default:t}}t(n.default)}).call(this,e("543d")["createPage"])},ef42:function(t,n,e){"use strict";var o=e("4121"),a=e.n(o);a.a},f070:function(t,n,e){"use strict";e.r(n);var o=e("606a"),a=e.n(o);for(var i in o)"default"!==i&&function(t){e.d(n,t,(function(){return o[t]}))}(i);n["default"]=a.a}},[["c38a","common/runtime","common/vendor"]]]);
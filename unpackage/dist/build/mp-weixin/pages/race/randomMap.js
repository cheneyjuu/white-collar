(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/race/randomMap"],{"1dfc":function(t,e,n){},2488:function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return r})),n.d(e,"a",(function(){return a}));var o=function(){var t=this,e=t.$createElement;t._self._c},r=[]},2720:function(t,e,n){"use strict";n.r(e);var a=n("2488"),o=n("3a34");for(var r in o)"default"!==r&&function(t){n.d(e,t,(function(){return o[t]}))}(r);n("a6bd");var c,i=n("f0c5"),l=Object(i["a"])(o["default"],a["b"],a["c"],!1,null,null,null,!1,a["a"],c);e["default"]=l.exports},"3a34":function(t,e,n){"use strict";n.r(e);var a=n("70cd"),o=n.n(a);for(var r in a)"default"!==r&&function(t){n.d(e,t,(function(){return a[t]}))}(r);e["default"]=o.a},"70cd":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=r(n("277c"));function o(){if("function"!==typeof WeakMap)return null;var t=new WeakMap;return o=function(){return t},t}function r(t){if(t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var e=o();if(e&&e.has(t))return e.get(t);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var r in t)if(Object.prototype.hasOwnProperty.call(t,r)){var c=a?Object.getOwnPropertyDescriptor(t,r):null;c&&(c.get||c.set)?Object.defineProperty(n,r,c):n[r]=t[r]}return n.default=t,e&&e.set(t,n),n}var c={data:function(){return{raceId:"",itemId:"",lng:0,lat:0,isStart:!1,raceInterval:null,markers:[],polyline:[{points:[],color:"#12aa9cDD",width:2,dottedLine:!1}],enableScroll:!0,nums:"00:00:00",timer:null,myInterval:null,drawInterval:null,checkInterval:null,speed:0,covers:[],meters:0,info:"",minute:0,hour:0,oriMeters:0,showMeters:0,pointTitles:[],scroll:-1,currentPoint:{},currentIndex:0,currentPointStr:null,showDialog:!1,checkinIndexList:[],data:[],modalName:null,complete:!1,raceInfo:t.getStorageSync("raceInfo")?t.getStorageSync("raceInfo"):{itemId:null,index:0,complete:!1},userCheckedIndexList:[],isDebug:!1}},methods:{regionchange:function(t){},markertap:function(t){},controltap:function(t){},reloadData:function(){var e=this,n=t.getStorageSync("id_token"),o=e.itemId;t.request({url:"".concat(a.baseUrl,"/races/items/").concat(o,"/routes"),method:"GET",header:{"content-type":"application/json",Authorization:"Bearer "+n},success:function(t){var n=t.data.data;e.data=n,e.pointTitles=[];var a=!0;if(e.data.forEach((function(t){e.pointTitles.push({title:t.title,checked:t.checkedFlag}),!1===t.checkedFlag&&(a=!1)})),a)return e.modalName="DialogModal1",e.showDialog=!1,clearInterval(e.myInterval),clearInterval(e.timer),void clearInterval(e.drawInterval)},fail:function(){},complete:function(){}})},loadRouteData:function(e){var n=this,o=t.getStorageSync("id_token");n.itemId=e,t.request({url:"".concat(a.baseUrl,"/races/items/").concat(e,"/routes"),method:"GET",header:{"content-type":"application/json",Authorization:"Bearer "+o},success:function(t){var e=t.data.data;n.data=e,console.group("路线数据"),console.log(e),n.countTime(),n.data.forEach((function(t,e){n.pointTitles.push({title:t.title,checked:t.checkedFlag});var a="/static/map/location.png",o={iconPath:a,id:e,longitude:t.lng,latitude:t.lat,width:32,height:32};n.markers.push(o)}))},fail:function(){},complete:function(){}})},getLocation:function(){var t=this;t.myInterval=setInterval((function(){t.data&&wx.getLocation({type:"gcj02",success:function(e){var n=e.latitude,a=e.longitude;t.isDebug&&(a=120.488069,n=31.493672);var o={longitude:a,latitude:n};t.drawline(o),t.data.forEach((function(e,o){if(!e.checkedFlag){var r=e.lat,c=e.lng,i=t.getDistance(n,a,r,c);i<=120&&(t.currentPoint=e,t.currentIndex=o,console.log("currentIndex",o),t.showDialog=!0,t.autoCheckIn(e,n,a))}}))}})}),2e3)},autoCheckIn:function(e,n,o){var r=this,c=t.getStorageSync("id_token"),i={itemId:e.itemId,title:e.title,checkInPoint:n+","+o,spendTime:r.nums};t.request({url:"".concat(a.baseUrl,"/races/items/routes/checkin"),method:"POST",header:{"content-type":"application/json",Authorization:"Bearer "+c},data:i,success:function(t){t.data.data;r.reloadData()},fail:function(){},complete:function(){}})},hideModal:function(t){this.modalName=null},completeRace:function(){this.modalName=null,t.removeStorageSync("raceInfo"),t.removeStorageSync("userCheckedIndexList"),t.navigateBack({delta:1})},getDistance:function(t,e,n,a){var o=0,r=u(t),c=u(n),i=r-c,l=u(e)-u(a);o=2*Math.asin(Math.sqrt(Math.pow(Math.sin(i/2),2)+Math.cos(r)*Math.cos(c)*Math.pow(Math.sin(l/2),2)));return 6378137*o;function u(t){return t*Math.PI/180}},countTime:function(){var t,e,n,a=this;t=e=n=0;var o=0;a.timer=setInterval((function(){o+=50,o>=1e3&&(o=0,n+=1),n>=60&&(n=0,e+=1,a.minute=e),e>=60&&(e=0,t+=1,a.hour=t),a.nums=t+":"+e+":"+n}),50)},drawline:function(t){this.polyline[0].points.push(t)}},onLoad:function(t){this.raceId=t.raceId,this.itemId=t.itemId;var e=this;e.isDebug?(this.lng=120.488069,this.lat=31.493672):wx.getLocation({type:"gcj02",isHighAccuracy:!0,success:function(t){console.log(t),e.lat=t.latitude,e.lng=t.longitude}}),this.loadRouteData(this.itemId),this.getLocation()},onUnload:function(){clearInterval(this.myInterval),clearInterval(this.timer),clearInterval(this.drawInterval)}};e.default=c}).call(this,n("543d")["default"])},a6bd:function(t,e,n){"use strict";var a=n("1dfc"),o=n.n(a);o.a},ff56:function(t,e,n){"use strict";(function(t){n("18a1");a(n("66fd"));var e=a(n("2720"));function a(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])}},[["ff56","common/runtime","common/vendor"]]]);
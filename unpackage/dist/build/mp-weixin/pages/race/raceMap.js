(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/race/raceMap"],{"1b5e":function(t,e,n){"use strict";var o,r=function(){var t=this,e=t.$createElement;t._self._c},i=[];n.d(e,"b",(function(){return r})),n.d(e,"c",(function(){return i})),n.d(e,"a",(function(){return o}))},"1f95":function(t,e,n){"use strict";(function(t){n("18a1");o(n("66fd"));var e=o(n("6046"));function o(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,n("543d")["createPage"])},"332c":function(t,e,n){},"35ca":function(t,e,n){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var o=i(n("277c"));function r(){if("function"!==typeof WeakMap)return null;var t=new WeakMap;return r=function(){return t},t}function i(t){if(t&&t.__esModule)return t;if(null===t||"object"!==typeof t&&"function"!==typeof t)return{default:t};var e=r();if(e&&e.has(t))return e.get(t);var n={},o=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if(Object.prototype.hasOwnProperty.call(t,i)){var a=o?Object.getOwnPropertyDescriptor(t,i):null;a&&(a.get||a.set)?Object.defineProperty(n,i,a):n[i]=t[i]}return n.default=t,e&&e.set(t,n),n}var a={data:function(){return{raceId:"",itemId:"",lng:0,lat:0,isStart:!1,raceInterval:null,markers:[],polyline:[{points:[],color:"#12aa9cDD",width:2,dottedLine:!1}],nums:"00:00:00",timer:null,myInterval:null,speed:0,covers:[],meters:0,info:"",minute:0,hour:0,oriMeters:0,showMeters:0,pointTitles:[],scroll:-1,currentPoint:{},currentIndex:0,currentPointStr:null,showDialog:!1,checkinIndexList:[],data:[],modalName:null,isDebug:!1}},methods:{regionchange:function(t){},markertap:function(t){},controltap:function(t){},loadRouteData:function(e){var n=this,r=t.getStorageSync("id_token");t.getStorageSync("userInfo");t.request({url:"".concat(o.baseUrl,"/races/items/").concat(e,"/routes"),method:"GET",header:{"content-type":"application/json",Authorization:"Bearer "+r},success:function(t){var e=t.data.data;console.log(e),n.data=e,e.forEach((function(t,e){n.pointTitles.push(t.title);var o="/static/map/".concat(e,".png"),r=32,i=32;0===e&&(o="/static/map/start.png",r=48,i=48);var a={iconPath:o,id:e,longitude:t.lng,latitude:t.lat,width:r,height:i};n.markers.push(a)})),console.log(n.markers),n.currentPoint=n.data[n.currentIndex],n.myInterval=setInterval((function(){var t=n.currentPoint,e=t.lng,o=t.lat;console.log("经纬度"),console.log(e,o),wx.getLocation({type:"gcj02",success:function(t){var r,i;n.isDebug?(r=31.493672,i=120.488069):(r=t.latitude,i=t.longitude);var a=t.speed;a>0&&(n.speed=a.toFixed(2));var c={longitude:i,latitude:r};n.drawline(c),n.currentPointStr=r+","+i;var l=n.getDistance(r,i,o,e),s=n.currentIndex;console.log(l,s,-1===n.checkinIndexList.findIndex((function(t){return t===s}))),l<=150&&-1===n.checkinIndexList.findIndex((function(t){return t===s}))&&(console.log("11111"),n.showDialog=!0,n.lng=e,n.lat=o)}})}),2e3)},fail:function(){},complete:function(){}})},checkin:function(){var e=this,n=t.getStorageSync("id_token"),r=(t.getStorageSync("userInfo"),e.itemId);e.countTime(),e.checkinIndexList.push(e.currentIndex),e.scroll=e.currentIndex;var i={itemId:{id:r},title:e.currentPoint.title,checkInPoint:e.currentPointStr,spendTime:e.nums};if(t.request({url:"".concat(o.baseUrl,"/races/items/routes/checkin"),method:"POST",header:{"content-type":"application/json",Authorization:"Bearer "+n},data:i,success:function(t){var e=t.data.data;console.log(e)},fail:function(){},complete:function(){}}),e.currentIndex===e.data.length-1)return this.modalName="DialogModal1",e.showDialog=!1,clearInterval(e.myInterval),void clearInterval(e.timer);e.currentIndex+=1,console.log("currentIndex",e.currentIndex),e.showDialog=!1,e.currentPoint=e.data[e.currentIndex]},hideModal:function(t){this.modalName=null},getDistance:function(t,e,n,o){var r=0,i=s(t),a=s(n),c=i-a,l=s(e)-s(o);r=2*Math.asin(Math.sqrt(Math.pow(Math.sin(c/2),2)+Math.cos(i)*Math.cos(a)*Math.pow(Math.sin(l/2),2)));return 6378137*r;function s(t){return t*Math.PI/180}},countTime:function(){var t,e,n,o=this;t=e=n=0;var r=0;o.timer=setInterval((function(){r+=50,r>=1e3&&(r=0,n+=1),n>=60&&(n=0,e+=1,o.minute=e),e>=60&&(e=0,t+=1,o.hour=t),o.nums=t+":"+e+":"+n}),50)},startRace:function(){var t=this;this.polyline[0].points=[],t.raceInterval=setInterval((function(){wx.getLocation({type:"gcj02",success:function(e){console.log(e);var n=e.latitude,o=e.longitude,r=e.speed;r>0&&(t.speed=r.toFixed(2));var i,a={longitude:o,latitude:n},c={latitude:e.latitude,longitude:e.longitude,iconPath:"/static/location.png"},l=t.covers,s=l.length;0==s&&l.push(c),s=l.length,i=l[s-1],console.log("oriCovers----------"),console.log(l,s);var u=t.getDistance(i.latitude,i.longitude,e.latitude,e.longitude)/1e3;u<.0015&&(u=0),t.oriMeters=t.oriMeters+u,console.log("newMeters----------"),console.log(u),console.log("oriMeters:",t.oriMeters);var d=new Number(t.oriMeters),f=d.toFixed(2);console.log("showMeters:",f),t.meters=f,l.push(c),t.drawline(a)}}),console.log(t.polyline[0])}),2e3),t.isStart=!0,t.countTime()},drawline:function(t){this.polyline[0].points.push(t)},endRace:function(){var e=t.getStorageSync("id_token");clearInterval(this.raceInterval),clearInterval(this.timer),this.isStart=!1;var n={points:this.polyline[0].points,raceId:{id:this.raceId},itemId:{id:this.itemId},spendTime:this.nums,score:this.meters};t.request({url:"".concat(o.baseUrl,"/races/items/scores"),method:"PUT",data:n,header:{"content-type":"application/json",Authorization:"Bearer "+e},success:function(t){var e=t.data.data;console.log(e)},fail:function(){},complete:function(){}})},mapUpdate:function(){wx.startLocationUpdate({success:function(e){t.showToast({icon:"none",title:JSON.stringify(e)})},complete:function(t){console.log("获取位置"),console.log(t)}})}},onLoad:function(t){this.raceId=t.raceId,this.itemId=t.itemId;var e=this;wx.startLocationUpdateBackground({success:function(t){console.log(t)}}),e.isDebug?(this.lng=120.488069,this.lat=31.493672):wx.getLocation({type:"gcj02",isHighAccuracy:!0,success:function(t){console.log(t),e.lat=t.latitude,e.lng=t.longitude}}),this.loadRouteData(this.itemId)},onUnload:function(){clearInterval(this.myInterval),clearInterval(this.timer)}};e.default=a}).call(this,n("543d")["default"])},"58f5":function(t,e,n){"use strict";var o=n("332c"),r=n.n(o);r.a},6046:function(t,e,n){"use strict";n.r(e);var o=n("1b5e"),r=n("6d24");for(var i in r)"default"!==i&&function(t){n.d(e,t,(function(){return r[t]}))}(i);n("58f5");var a,c=n("f0c5"),l=Object(c["a"])(r["default"],o["b"],o["c"],!1,null,null,null,!1,o["a"],a);e["default"]=l.exports},"6d24":function(t,e,n){"use strict";n.r(e);var o=n("35ca"),r=n.n(o);for(var i in o)"default"!==i&&function(t){n.d(e,t,(function(){return o[t]}))}(i);e["default"]=r.a}},[["1f95","common/runtime","common/vendor"]]]);